{% extends 'base.html' %}
{% load static_grouper static i18n %}


{% block header %}
  <h1>
    {% block title %}
      {# FIXME: Cette ligne créé deux requêtes SQL inutiles. Comme model est callable, Django instancie le modèle et doit aller chercher l’état nouveau. #}
      {{ model.meta.verbose_name_plural|capfirst }}
    {% endblock %}
  </h1>
{% endblock %}


{% block content %}
  <div id="table">
    <header class="row">
      <form class="col-md-3">
        <div class="input-group">
          <input type="text" placeholder="{% trans 'Search…' %}" class="form-control" />
          <span class="input-group-btn">
            <button type="submit" class="btn btn-default">
              <i class="fa fa-search"></i>
            </button>
          </span>
        </div>
      </form>
      <div class="col-md-2">
        <span class="count"></span>
        <span class="spinner pull-right" style="display: none;">
          <i class="fa fa-spinner fa-spin"></i>
        </span>

      </div>
      <nav class="col-md-7 text-right">
        <ul class="pagination pagination-sm"></ul>
      </nav>
    </header>

    <table class="table table-condensed table-striped table-bordered">
      <thead></thead>
      <tbody></tbody>
    </table>

  </div>

  {% addstatic css %}
    <style>
      #table header {
        margin-bottom: 20px;
      }
      #table .count, #table .spinner {
        display: inline-block;
        height: 34px;
        padding: 6px 0;
        vertical-align: middle;
        cursor: default;
        user-select: none;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
      }
      #table .pagination {
        margin: 0;
      }
      #table th {
        padding: 0;
        cursor: default;
        user-select: none;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
      }
      #table .unsortable, #table .sortable, #table .filter {
        display: inline-block;
        vertical-align: bottom;
        height: 30px;
      }
      #table .sortable, #table .filter {
        cursor: pointer;
      }
      #table .unsortable, #table .sortable {
        width: calc(100% - 32px);
        padding: 5px;
      }
      #table .sortable:last-child {
        width: 100%;
      }
      #table thead .column-name, #table thead .fa {
        vertical-align: middle;
      }
      #table .column-name {
        display: inline-block;
        white-space: nowrap;
        overflow-x: hidden;
        text-overflow: ellipsis;
      }
      #table .sortable .column-name {
        width: calc(100% - 15px);
      }
      #table .unsortable .column-name {
        width: 100%;
      }
      #table .sortable .fa {
        width: 15px;
        text-align: right;
      }
      #table .filter-button {
        display: inline-block;
        width: 32px;
        padding: 6px 10px 5px;
      }
      #table .filter.active .filter-button {
        background: #ec8055;
        color: white;
      }
      #table .filter .dropdown-menu {
        max-height: 300px;
        overflow-y: auto;
      }
    </style>
  {% endaddstatic %}

  {% addstatic js %}
    <script src="{% static 'js/tablature.js' %}"></script>
  {% endaddstatic %}

  {% addstatic js %}
    <script>
      $(function () {
        var filters = [
          {% for filter in filters %}
            [
              {% for value, verbose in filter %}
                ['{{ value|escapejs }}','{{ verbose|escapejs }}']{% if not forloop.last %},{% endif %}
              {% endfor %}
            ]{% if not forloop.last %},{% endif %}
          {% endfor %}
        ];
        new Table(
          $('#table'), ['{{ columns|join:"','" }}'],
          [{{ sortables|join:',' }}], filters,
          {{ results_per_page }}, '{% trans 'results' %}'
        );
      });
    </script>
  {% endaddstatic %}

{% endblock %}
