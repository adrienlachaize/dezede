{% extends 'base.html' %}
{% load highlight %}
{% load extras %}

{% block title %}
  Recherche
{% endblock %}

{% block body %}
  <h2>Recherche</h2>

  <form method="get" action=".">
    <table>
      {{ form.as_table }}
      <tr>
        <td>&nbsp;</td>
        <td>
          <input type="submit" value="Chercher">
        </td>
      </tr>
    </table>

    {% if query %}
      <h3>Résultats</h3>

      {% if page.has_previous %}<a href="?{{ request.GET.urlencode }}&page={{ page.previous_page_number }}">« Précédents</a>{% endif %}
      {% if page.has_previous and page.has_next %}|{% endif %}
      {% if page.has_next %}<a href="?{{ request.GET.urlencode }}&page={{ page.next_page_number }}">Suivants »</a>{% endif %}

      {% for result in page.object_list %}
        <div class="result {{ result.model.class_name.lower }}">
          <h3>{{ result.model.verbose_name|capfirst }}</h3>
          {% if result.object.link %}
            {{ result.object.link }}<br />
          {% else %}
            {{ result.object.html }}<br />
          {% endif %}
          <small>
            {% highlight result.object.html with query html_tag 'mark' %}
          </small>
        </div>
      {% empty %}
        <p>Aucun résultat trouvé.</p>
      {% endfor %}

      {% if page.has_previous %}<a href="?{{ request.GET.urlencode }}&page={{ page.previous_page_number }}">« Précédents</a>{% endif %}
      {% if page.has_previous and page.has_next %}|{% endif %}
      {% if page.has_next %}<a href="?{{ request.GET.urlencode }}&page={{ page.next_page_number }}">Suivants »</a>{% endif %}
    {% else %}
      {# Show some example queries to run, maybe query syntax, something else? #}
    {% endif %}
  </form>
{% endblock %}
