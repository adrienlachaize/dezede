{% extends "base.html" %}
{% load i18n %}
{% load extras %}
{% load url from future %}

{% block title %}
  {% for element in datalist %}
    {% with element|first as evenement %}
      {{ evenement.lieu }}, {{ evenement.date_debut }}{% if not forloop.last %} &ndash;{% endif %}
    {% endwith %}
  {% endfor %}
{% endblock %}

{% block body %}
  {% for element in datalist %}
    {% with element|first as evenement %}{% with element|last as types %}
      <div style="border: 1.5px solid; border-radius: 15px; padding: 20px; margin-bottom: 30px;">
        <h3 style="text-align: center;">{{ evenement.date_debut|date|capfirst }}</h3>
        {% if evenement.lieu.parent %}{{ evenement.lieu.parent.nom }},{% endif %}
        <a href="{% url 'catalogue.views.index_lieux' %}{{ evenement.lieu.slug }}">
          {{ evenement.lieu.nom }}</a><br />
        {% if evenement.circonstance %}Circonstance : {{ evenement.circonstance }}<br />{% endif %}
        {% if evenement.heure %}Horaire : {{ evenement.heure|time }}<br />{% endif %}
        {% for representation in evenement.representations.all %}
          {% for oeuvre in representation.oeuvres.all %}
            {% if forloop.first %}
              <ol>
            {% endif %}
            <li>
            {% for auteur in oeuvre.auteurs.all %}
              <a href="{% url 'catalogue.views.index_individus' %}{{ auteur.slug }}/">
              <span style="font-variant: small-caps;">{{ auteur.nom }}</span> ({{ auteur.prenoms|abbreviate:0 }})</a> [{% for profession in auteur.professions.all %}{{ profession.nom|abbreviate:1 }}{% if not forloop.last %}, {% endif %}{% endfor %}],
            {% endfor %}<i>{{ oeuvre }}</i>, {{ oeuvre.genre }}</li>
            {% if forloop.last %}
              </ol>
            {% endif %}
          {% endfor %}
        {% endfor %}
        <br />
        {% for type in types %}
          <h4 style="text-align: center; font-style: italic;">{% if type.pluriel %}{{ type.pluriel|capfirst }}{% else %}{{ type|capfirst }}s{% endif %}</h4>
          {% for source in evenement.sources.all %}
            {% if source.type == type %}
              <div style="text-align: justify;">
                {{ source.contenu|replace|safe }}
                (<em>{{ source.nom }}</em> {% if source.numero %}n° {{ source.numero }}{% endif %} du {{ source.date|date }}{% if source.page %}, p. {{ source.page }}{% endif %})
              </div>
            {% endif %}
          {% endfor %}
        {% endfor %}
      </div>
    {% endwith %}{% endwith %}
  {% empty %}
    <div style="text-align: center;">{% trans "Aucune source n'a été trouvée selon ces critères." %}</div>
  {% endfor %}
{% endblock %}
