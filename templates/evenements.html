{% extends "base.html" %}
{% load i18n %}
{% load extras %}
{% load url from future %}

{% block title %}
  {% for element in datalist %}
    {% with element|first as evenement %}
      {{ evenement.ancrage_debut }}{% if not forloop.last %} &ndash;{% endif %}
    {% endwith %}
  {% endfor %}
{% endblock %}

{% block body %}
  {% for element in datalist %}
    {% with element|first as evenement %}{% with element|last as types %}
      <div style="border: 1.5px solid; border-radius: 15px; padding: 20px; margin-bottom: 30px;">
        <h3 style="text-align: center;">{{ evenement.ancrage_debut.calc_date }}</h3>
        {{ evenement.ancrage_debut.lieu.html|safe }}<br />
        {% if evenement.circonstance %}Circonstance : {{ evenement.circonstance }}<br />{% endif %}
        {% if evenement.ancrage_debut.heure %}Horaire : {{ evenement.ancrage_debut.calc_heure }}<br />{% endif %}
        <h4>Programme :</h4>
        {% for element in evenement.programme.all %}
          {% if forloop.first %}
            <ol>
          {% endif %}
          <li>
            {{ element.html|safe }}
          </li>
          {% if forloop.last %}
            </ol>
          {% endif %}
        {% endfor %}
        <br />
        {% for type in types %}
          <h4 style="text-align: center; font-style: italic;">{{ type.pluriel|capfirst }}</h4>
          {% for source in evenement.sources.all %}
            {% if source.type == type %}
              <div style="text-align: justify;">
                {{ source.contenu|replace|safe }}
                (<em>{{ source.nom }}</em> {% if source.numero %}n° {{ source.numero }}{% endif %} du {{ source.date|date }}{% if source.page %}, p. {{ source.page }}{% endif %})
              </div>
            {% endif %}
          {% endfor %}
        {% endfor %}
      </div>
    {% endwith %}{% endwith %}
  {% empty %}
    <div style="text-align: center;">{% trans "Aucune source n'a été trouvée selon ces critères." %}</div>
  {% endfor %}
{% endblock %}
