{% extends "base.html" %}
{% load i18n %}
{% load extras routines %}
{% load url from future %}

{% block title %}
  {{ oeuvre }}
{% endblock %}

{% block body %}

  {% include "libretto/include/etat.html" with etat=oeuvre.etat %}

  <div class="page-header">
    {% frontend_admin autorite=1 %}
    <h1>
      {{ oeuvre.titre_html }}
    </h1>
    <h2>
      {{ oeuvre.description_html }}
    </h2>
    <h3>
      {{ oeuvre.auteurs_html }}
    </h3>
    <h3 title="{% trans 'CrÃ©ation' %}">
      {{ oeuvre.ancrage_creation.html|default:'' }}
    </h3>
    <h4>
      <table class="data-table">
        {% regroup oeuvre.parentes_meres.meres_en_ordre by type as parentes_list %}
        {% for parentes in parentes_list %}
          {% for parente in parentes.list %}
            <tr>
              {% if forloop.first %}
                <th>{{ parentes.grouper.nom|capfirst }}</th>
              {% else %}
                <td></td>
              {% endif %}
              <td>{{ parente.mere.html }}</td>
            </tr>
          {% endfor %}
        {% endfor %}
        {% regroup oeuvre.parentes_filles.filles_en_ordre by type as parentes_list %}
        {% for parentes in parentes_list %}
          {% for parente in parentes.list %}
            <tr>
              {% if forloop.first %}
                <th>
                  {% if parentes.list|length_is:'1' %}
                    {{ parentes.grouper.nom_relatif|capfirst }}
                  {% else %}
                    {{ parentes.grouper.relatif_pluriel|capfirst }}
                  {% endif %}
                </th>
              {% else %}
                <td></td>
              {% endif %}
              <td>{{ parente.fille.html }}</td>
            </tr>
          {% endfor %}
        {% endfor %}
      </table>
    </h4>
  </div>

  <div class="span3 pull-right">
    {% include 'libretto/include/illustrations.html' %}
  </div>

  <table class="data-table">
    {% data_table_attr 'pupitres_html' _('effectif') %}

    {% with contenu=oeuvre.get_descendants %}
      {% if contenu %}
        <th>{% trans 'Contenu' %}</th>
        <td>
          {% jstree contenu 'short_html' %}
        </td>
      {% endif %}
    {% endwith %}

    {% include "libretto/evenement_list_def.html" with evenements=oeuvre.evenements.distinct %}
    {% data_table_attr 'notes' %}

    {% data_table_list oeuvre.documents.all %}
  </table>

{% endblock %}
