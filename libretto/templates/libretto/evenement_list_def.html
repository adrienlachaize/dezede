{% load i18n extras %}
{% load url from future %}

{% regroup evenements by ancrage_debut.date.year as year_list %}
{% for year in year_list %}

  <tr>

    {% if forloop.first %}
      {% with counter=evenements.count %}
        {% if counter %}
          <th>
            {% filter capfirst %}{% blocktrans count counter=counter %}événement
            {% plural %}événements{% endblocktrans %}{% endfilter %}
          </th>
        {% endif %}
      {% endwith %}
      {% else %}
      <td></td>
    {% endif %}

    <td>
      <a href="{% url 'evenements' %}?{{ object.class_name|lower }}=|{{ object.pk }}|&dates_0={{ year.grouper }}&dates_1={{ year.grouper }}">
        {% if year.list|length_is:1 %}
          {% if lieu %}
            {{ year.list.0.ancrage_debut.calc_moment|capfirst }}
          {% else %}
            {{ year.list.0.ancrage_debut.html|removetags:'a' }}
          {% endif %}
        {% else %}
          {{ year.grouper }} ({{ year.list|length }}
          {% filter abbreviate:2 %}{% trans 'événements' %}{% endfilter %})
        {% endif %}
      </a>
    </td>

  </tr>

{% endfor %}

{% if evenements.count > 1 %}
  <tr>
    <td></td>
    <td>
      <a href="{% url 'evenements' %}?{{ object.class_name|lower }}=|{{ object.pk }}|">
        <strong>{% trans "Afficher tous les événements" %}</strong>
      </a>
    </td>
  </tr>
{% endif %}
