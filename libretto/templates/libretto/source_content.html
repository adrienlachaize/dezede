{% load thumbnail i18n %}

{% with fichiers=source.fichiers_by_type %}

  {% if fichiers.audios or fichier.videos or fichiers.others %}
    <ul class="list-unstyled">

      {% for audio in fichiers.audios %}
        <li>
          <audio controls preload="auto">
            {% for src in audio %}
              <source src="{{ src.fichier.url }}"
                      type="audio/{{ src.format }}" />
            {% endfor %}
          </audio>
        </li>
      {% endfor %}

      {% for video in fichiers.videos %}
        <li>
          <video width="640" height="360" controls preload="auto">
            {% for src in video %}
              <source src="{{ src.fichier.url }}"
                      type="video/{{ src.format }}" />
            {% endfor %}
          </video>
        </li>
      {% endfor %}

      {% for other in fichiers.others %}
        <li>
          <a href="{{ other.fichier.url }}">
            <i class="fa fa-paperclip"></i>
            {{ other.get_filename }} ({{ other.fichier.size|filesizeformat }})
          </a>
        </li>
      {% endfor %}

    </ul>
  {% endif %}

  {% if fichiers.images %}
    <div id="reader-{{ source.pk }}" class="reader">
      <div class="btn-group">
        <a href="#" class="zoom btn btn-default">
          <i class="fa fa-fw fa-search-plus"></i>
        </a>
        <a href="#" class="save btn btn-default">
          <i class="fa fa-fw fa-save"></i>
        </a>
        <a href="#" class="print btn btn-default">
          <i class="fa fa-fw fa-print"></i>
        </a>
      </div>
      <div class="row">
        <a href="#" class="prev col-xs-1 btn btn-default invisible">
          <i class="fa fa-angle-left fa-5x"></i>
        </a>
        <div class="main-container col-xs-10">
          <div class="spinner-container">
            <i class="fa fa-spinner fa-spin fa-5x"></i>
          </div>
          <div class="img-container">
            <img src="" />
          </div>
        </div>
        <a href="#" class="next col-xs-1 btn btn-default invisible">
          <i class="fa fa-angle-right fa-5x"></i>
        </a>
      </div>
    </div>
    <script>
      $(function () {
        var images = [
          {% for image in fichiers.images %}
            {% if image.is_image %}
              {small: '{% thumbnail image.fichier 'small' %}',
               medium: '{% thumbnail image.fichier 'medium' %}',
               original: '{{ image.fichier.url }}'}{% if not forloop.last %},{% endif %}
            {% endif %}
          {% endfor %}
        ];
        new Reader($('#reader-{{ source.pk }}'), images);
      });
    </script>
  {% endif %}
{% endwith %}


{% if source.transcription %}
  <blockquote class="source">

    <div class="transcription">
      {{ source.transcription|safe }}
    </div>
    {% if source.auteurs.exists %}
      <footer class="auteurs">
        {{ source.auteurs_html }}
      </footer>
    {% endif %}

  </blockquote>
{% endif %}

{% if source.url %}
  <a href="{{ source.url }}">
    <i class="fa fa-external-link fa-fw"></i> {{ source.url }}
  </a>
{% endif %}

<script>
  tooltips_reload();
</script>
